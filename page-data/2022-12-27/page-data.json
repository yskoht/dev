{"componentChunkName":"component---src-templates-post-tsx","path":"/2022-12-27","result":{"data":{"markdownRemark":{"html":"<h1>haskell: 関数もモナドになる</h1>\n<p><a href=\"http://www.nct9.ne.jp/m_hiroi/func/haskell18.html\">モナド(2) - お気楽 Haskell プログラミング入門</a> を読んだ。</p>\n<div class=\"gatsby-highlight\" data-language=\"hs\"><pre class=\"language-hs\"><code class=\"language-hs\"><span class=\"token operator\">>>=</span> <span class=\"token operator\">::</span> <span class=\"token hvariable\">m</span> <span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">m</span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">m</span> <span class=\"token hvariable\">b</span>\n    <span class=\"token operator\">::</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-></span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">r</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-></span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">r</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-></span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">r</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">b</span>\n    <span class=\"token operator\">::</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">r</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">r</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">r</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>だから <code class=\"language-text\">m a</code> を評価すると型は <code class=\"language-text\">a</code> になるし、<code class=\"language-text\">>>=</code> で <code class=\"language-text\">r</code> も伝搬される。</p>\n<hr>\n<h1>haskell: State モナド</h1>\n<p>『すごい Haskell 楽しく学ぼう！』の P335 について考えたことのメモ。</p>\n<div class=\"gatsby-highlight\" data-language=\"hs\"><pre class=\"language-hs\"><code class=\"language-hs\"><span class=\"token keyword\">newtype</span> <span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span> <span class=\"token hvariable\">a</span> <span class=\"token operator\">=</span> <span class=\"token constant\">State</span> <span class=\"token punctuation\">{</span> <span class=\"token hvariable\">runState</span> <span class=\"token operator\">::</span> <span class=\"token hvariable\">s</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>State 型は <code class=\"language-text\">runState</code> というフィールドを持っていて、その型は <code class=\"language-text\">s -> (a, s)</code>。</p>\n<div class=\"gatsby-highlight\" data-language=\"hs\"><pre class=\"language-hs\"><code class=\"language-hs\"><span class=\"token keyword\">instance</span> <span class=\"token constant\">Monad</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">where</span>\n  <span class=\"token builtin\">return</span> <span class=\"token hvariable\">x</span> <span class=\"token operator\">=</span> <span class=\"token constant\">State</span> <span class=\"token operator\">$</span> <span class=\"token operator\">\\</span><span class=\"token hvariable\">s</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">x</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">h</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>>=</span> <span class=\"token hvariable\">f</span> <span class=\"token operator\">=</span> <span class=\"token constant\">State</span> <span class=\"token operator\">$</span> <span class=\"token operator\">\\</span><span class=\"token hvariable\">s</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">newState</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">h</span> <span class=\"token hvariable\">s</span>\n                                      <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">g</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">f</span> <span class=\"token hvariable\">a</span>\n                                  <span class=\"token keyword\">in</span> <span class=\"token hvariable\">g</span> <span class=\"token hvariable\">newState</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"hs\"><pre class=\"language-hs\"><code class=\"language-hs\"><span class=\"token operator\">>>=</span> <span class=\"token operator\">::</span> <span class=\"token hvariable\">m</span> <span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">m</span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">m</span> <span class=\"token hvariable\">b</span>\n    <span class=\"token operator\">::</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">b</span>\n    <span class=\"token operator\">::</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span> <span class=\"token hvariable\">a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State</span> <span class=\"token hvariable\">s</span> <span class=\"token hvariable\">b</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">::</span> <span class=\"token constant\">State</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">s</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">a</span> <span class=\"token operator\">-></span> <span class=\"token constant\">State</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">s</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">b</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token constant\">State</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">s</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">b</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>毎回忘れるが、レコード構文では <code class=\"language-text\">State f</code> と書くのと <code class=\"language-text\">State { runState :: f }</code> は同じ。\nこれ本にかかれていない気がする。</p>\n<p><code class=\"language-text\">State h</code> の <code class=\"language-text\">h</code> は　<code class=\"language-text\">s -> (x, s)</code>。なので <code class=\"language-text\">h s</code> が <code class=\"language-text\">(a, newState)</code> になる。\n<code class=\"language-text\">f</code> は <code class=\"language-text\">a -> State (s -> (b, s))</code> なので <code class=\"language-text\">f a</code> は <code class=\"language-text\">State g</code> になる。\n<code class=\"language-text\">g</code> は <code class=\"language-text\">s -> (x, s)</code> なので <code class=\"language-text\">g newState</code> は <code class=\"language-text\">(x, s)</code> になる。\n全体として <code class=\"language-text\">State $ \\s -> (x, s)</code>。</p>","fields":{"slug":"/2022-12-27"}}},"pageContext":{"slug":"/2022-12-27","prevSlug":"/2022-12-26","nextSlug":"/2023-01-02"}},"staticQueryHashes":["63159454"]}