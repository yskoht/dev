# cgc: patch-package

- [ds300/patch\-package: Fix broken node modules instantly ðŸƒðŸ½â€â™€ï¸ðŸ’¨](https://github.com/ds300/patch-package)

asdf ã‚’ä½¿ã£ã¦ git ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã¨ãƒ‘ãƒƒãƒã®ä½œæˆãŒå¤±æ•—ã™ã‚‹ã€‚

```sh
$ npx patch-package ink
patch-package 7.0.0
â€¢ Creating temporary folder
â€¢ Installing ink@4.2.0 with npm
â€¢ Diffing your files with clean files
unknown command: git. Perhaps you have to reshim?
```

- [makePackch.ts#L169-L174](https://github.com/ds300/patch-package/blob/0b9b0150a2348bf53087198fcad84e862a35eebb/src/makePatch.ts#L169-L174)

```ts
const git = (...args: string[]) =>
  spawnSafeSync("git", args, {
    cwd: tmpRepo.name,
    env: { ...process.env, HOME: tmpRepo.name },
    maxBuffer: 1024 * 1024 * 100,
  })
```

`HOME` ãŒç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã€ `.asdf` ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€‚
`patch-package` ã«ä»¥ä¸‹ã‚’ãƒ‘ãƒƒãƒã™ã‚‹ã¨å‹•ãã€‚

```diff
diff --git a/node_modules/patch-package/dist/makePatch.js b/node_modules/patch-package/dist/makePatch.js
index a76e39c..5cbd541 100644
--- a/node_modules/patch-package/dist/makePatch.js
+++ b/node_modules/patch-package/dist/makePatch.js
@@ -102,6 +102,14 @@ function makePatch({ packagePathSpecifier, appPath, packageManager, includePaths
                 });
             }
         }
+
+        // for asdf
+        try {
+            const os = require("os");
+            spawnSafe_1.spawnSafeSync("ln", ["-s", `${os.homedir}/.asdf`, '.'], { cwd: tmpRepo.name });
+            spawnSafe_1.spawnSafeSync("ln", ["-s", `${os.homedir}/.tool-versions`, '.'], { cwd: tmpRepo.name });
+        } catch {}
+
         const git = (...args) => spawnSafe_1.spawnSafeSync("git", args, {
             cwd: tmpRepo.name,
             env: Object.assign(Object.assign({}, process.env), { HOME: tmpRepo.name }),
```
